<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz Interativo — Economia, Finanças e Investimentos</title>
  <style>
    :root {
      --bg-blue: #4da6ff;
      --card-bg: #fff8e6;
      --brown-border: #8a5a2b;
      --stardew-brown: #c08943;
      --accent: #7c3aed;
      --accent2: #f59e0b;
      --muted: #6b7280;
      --text: #112;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Inter, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      background: var(--bg-blue);
      overflow-x: hidden;
      color: var(--text);
    }

    /* Fundo */
    body {
      background-image: url('assets/tela_fundo.png');
      background-repeat: repeat-x;
      background-size: auto 100%;
      background-position: 0 0;
      animation: moveBg 60s linear infinite;
    }

    @keyframes moveBg {
      from {
        background-position: 0 0
      }

      to {
        background-position: -3000px 0
      }
    }

    /* layout raiz */
    .wrap {
      max-width: 920px;
      margin: 18px auto;
      padding: 12px;
      display: flex;
      gap: 16px;
      align-items: flex-start;
      justify-content: center;
      flex-wrap: wrap;
    }

    .card {
      background: var(--card-bg);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.14);
      border: 4px solid rgba(0, 0, 0, 0.06);
    }

    /* Menu: painel marrom — compacto, ligeiramente maior que os botões */
    .stardew-menu {
      width: 180px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px;
      border: 4px solid var(--brown-border);
      background: linear-gradient(180deg, #f4d9a8, #eed7a2);
      box-shadow: inset 0 -6px 0 rgba(0, 0, 0, 0.06), 0 8px 20px rgba(0, 0, 0, 0.12);
      border-radius: 12px;
      margin: 0 auto;
      min-height: 104px;
      box-sizing: border-box;
    }

    .stardew-menu .menu-img-btn {
      display: block;
      width: 75%;
      max-width: 130px;
      padding: 0;
      margin: 6px auto;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      background: transparent;
      border: none;
      box-shadow: 0 6px 0 rgba(0, 0, 0, 0.06);
      transition: transform .12s ease;
    }

    .stardew-menu .menu-img-btn img {
      width: 100%;
      height: auto;
      display: block;
      pointer-events: none;
    }

    .stardew-menu .menu-img-btn:active {
      transform: translateY(2px)
    }

    .menu-row {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: center;
      width: 100%;
      margin-top: 4px;
    }

    .icon-btn {
      background: transparent;
      border: none;
      padding: 6px;
      border-radius: 10px;
      cursor: pointer
    }

    .icon-btn img {
      width: 30px;
      height: 30px;
      display: block
    }

    /* DIMINUIÇÃO DO CARTÃO MARROM PRINCIPAL (QUIZ) */
    .quiz-card {
      flex: 1;
      max-width: 560px;
      /* limite geral do cartão */
      min-width: 220px;
      padding: 12px;
      /* um pouco menor */
      box-sizing: border-box;
    }

    /* AREA DE PERGUNTAS: reduzida, alinhada à esquerda para "colar" o mascote */
    .question-table {
      position: relative;
      max-width: 520px;
      /* <-- reduzido para caber semelhante à sua imagem */
      margin: 8px auto;
      text-align: left;
      padding: 10px 14px;
      box-sizing: border-box;
      background: transparent;
    }

    /* mascote ao canto esquerdo dentro da question-table */
    .mascote-wrap {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      justify-content: flex-start;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 6px;
    }

    #mascote {
      width: 110px;
      /* um pouco maior para ficar parecido com a sua imagem */
      height: auto;
      display: block;
      border-radius: 8px;
      flex: 0 0 auto;
      animation: flut 3s ease-in-out infinite;
    }

    @keyframes flut {

      0%,
      100% {
        transform: translateY(0)
      }

      50% {
        transform: translateY(-8px)
      }
    }

    /* balão ao lado do mascote — fica mais compacto e centralizado sobre as moedas */
    .speech {
      background: #fff;
      border: 2px solid rgba(0, 0, 0, 0.06);
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 14px;
      line-height: 1.25;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.04);
      overflow: hidden;
      max-width: 320px;
      /* pequeno e parecido com sua captura */
      width: calc(100% - 132px);
      /* ocupa o resto do espaço ao lado do mascote */
      transition: max-height 220ms ease, padding 160ms ease;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }

    #qCounter {
      display: none !important;
    }

    /* você pediu escondê-lo */
    #timer {
      font-weight: 800;
      color: #d97706;
      margin-left: 6px;
    }

    /* progresso: centralizado em 6 colunas, aparece logo abaixo do balão */
    .progress {
      display: grid;
      grid-template-columns: repeat(6, 34px);
      gap: 8px;
      justify-content: center;
      margin: 10px auto 14px;
    }

    .coin {
      width: 34px;
      height: 34px;
      background-image: url('assets/moeda.png');
      background-size: cover;
      opacity: .28;
      transition: opacity .18s, transform .2s;
    }

    .coin.active {
      opacity: 1;
      transform: translateY(-6px);
    }

    /* alternativas: ocupam mais largura (quase toda a tabela marrom) */
    .options {
      display: grid;
      grid-template-columns: repeat(1, 1fr);
      /* uma coluna em mobile/desktop para as opções largas */
      gap: 12px;
      justify-items: center;
      width: 100%;
    }

    .option {
      background: #f3f4f6;
      padding: 14px 18px;
      border-radius: 10px;
      border: 2px solid transparent;
      cursor: pointer;
      text-align: left;
      font-size: 16px;
      transition: transform .12s, box-shadow .12s;
      width: 100%;
      max-width: 100%;
      /* ocupa toda a largura disponível dentro de question-table */
      box-sizing: border-box;
    }

    .option:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 24px rgba(2, 6, 23, 0.06);
    }

    .option.correct {
      background: #16a34a;
      color: white;
      box-shadow: 0 8px 26px rgba(0, 0, 0, 0.08)
    }

    .option.wrong {
      background: #dc2626;
      color: white;
    }

    #explainBox {
      display: none;
      margin-top: 8px;
      background: rgba(0, 0, 0, 0.03);
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
      text-align: left;
      overflow: hidden;
      max-height: 0;
      transition: max-height 240ms ease, padding 180ms ease
    }

    #streakIndicator {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .st-star {
      width: 20px;
      height: 20px;
      background: rgba(0, 0, 0, 0.06);
      border-radius: 4px;
      transition: transform .12s, box-shadow .12s
    }

    .st-star.active {
      background: linear-gradient(90deg, #ffd700, #ffb000);
      box-shadow: 0 6px 18px rgba(255, 160, 0, 0.15);
      transform: scale(1.06)
    }

    .confete {
      position: fixed;
      width: 10px;
      height: 10px;
      border-radius: 2px;
      z-index: 9999;
      pointer-events: none;
      animation: fall 1700ms linear forwards
    }

    @keyframes fall {
      0% {
        opacity: 1;
        transform: translateY(-20px) rotate(0deg)
      }

      100% {
        opacity: 0;
        transform: translateY(220px) rotate(720deg)
      }
    }

    #result,
    #ranking {
      width: 100%;
      max-width: 640px
    }

    #medal img {
      width: 120px;
      display: block;
      margin: 12px auto
    }

    /* responsividade */
    @media (min-width:720px) {

      /* em telas maiores, manter uma coluna larga para as opções (sem duas colunas que encolhem) */
      .options {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width:720px) {
      .mascote-wrap {
        gap: 10px;
      }

      #mascote {
        width: 86px;
      }

      .speech {
        max-width: 260px;
        width: calc(100% - 110px);
      }

      .progress {
        grid-template-columns: repeat(6, 28px)
      }
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- título (fora da caixa marrom) -->
    <div style="display:flex;flex-direction:column;align-items:center;gap:8px;width:100%;">
      <img id="titleImg" src="assets/titulo.png" alt="Título"
        style="width:360px;max-width:86%;display:block;margin:6px auto 10px">
    </div>

    <!-- MENU (caixa marrom reduzida; sem título interno) -->
    <div id="menu" class="card stardew-menu" aria-label="Menu principal">
      <button id="imgPlay" class="menu-img-btn" aria-label="Jogar">
        <img src="assets/jogar.png" alt="Jogar">
      </button>

      <button id="imgRanking" class="menu-img-btn" aria-label="Ranking">
        <img src="assets/ranking.png" alt="Ranking">
      </button>

      <div class="menu-row">
        <button id="soundBtn" class="icon-btn" aria-label="Som">
          <img id="soundIcon" src="assets/som_ligado.png" alt="Som ligado">
        </button>
      </div>
    </div>

    <!-- QUIZ -->
    <div id="quizCard" class="card quiz-card hidden" role="application" aria-live="polite">

      <div class="question-table">
        <!-- mascote posicionado dentro da question-table, canto superior-esquerdo -->
        <div class="mascote-wrap">
          <img id="mascote" src="assets/mascote.png" alt="Mascote" />
          <div style="flex:1;min-width:0;">
            <div id="speech" class="speech" aria-live="polite"></div>
            <div class="top-row"
              style="margin-top:8px;align-items:center;display:flex;justify-content:flex-end;gap:8px">
              <div id="timer">Tempo: 20s</div>
            </div>
          </div>
        </div>

        <div class="progress" id="progressBar" aria-hidden="true"></div>
        <div id="question" style="display:none;">Pergunta aparecerá aqui</div>
        <!-- pergunta fica oculta (mas mantida p/ SR) -->
        <div class="options" id="options" role="list"></div>

        <div id="explainBox" aria-hidden="true">
          <div id="explainText"></div>
          <div style="text-align:right;margin-top:8px"><button id="closeExplainBtn"
              class="btn btn-ghost">Fechar</button></div>
        </div>

        <div
          style="margin-top:8px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
          <div id="score" style="font-weight:700">Pontuação: 0 | Multiplicador: x1.00</div>
          <div style="display:flex;gap:8px;align-items:center">
            <div id="streakIndicator">
              <div class="st-star" data-i="1"></div>
              <div class="st-star" data-i="2"></div>
              <div class="st-star" data-i="3"></div>
            </div>
            <button id="showExplainBtn" class="btn btn-ghost" style="display:none">Explicação</button>
            <button id="nextBtn" class="btn btn-primary" disabled>Próxima</button>
          </div>
        </div>
      </div>
    </div>

    <!-- RESULT -->
    <div id="result" class="card hidden" aria-live="polite">
      <h2>Fim de Jogo!</h2>
      <p id="finalScore">Sua pontuação final: 0 pontos</p>
      <div id="medal"></div>
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
        <input type="text" id="playerName" placeholder="Digite seu nome (2-20 chars)"
          style="flex:1;padding:8px;border-radius:6px;border:1px solid #ccc">
        <button id="saveScoreBtn" class="btn btn-primary">Salvar</button>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="replayBtn" class="btn btn-secondary">Jogar Novamente</button>
        <button id="viewRankingBtn" class="btn btn-ghost">Ver Ranking</button>
        <button id="backToMenuBtn" class="btn btn-ghost">Voltar ao Menu</button>
      </div>
    </div>

    <!-- RANKING -->
    <div id="ranking" class="card hidden" aria-live="polite">
      <h2>Ranking (Top 10)</h2>
      <ul id="rankingList" style="list-style:none;padding:0;margin:0"></ul>
      <div style="margin-top:12px;display:flex;gap:8px"><button id="backBtn" class="btn btn-primary">Voltar</button>
      </div>
    </div>
  </div>

  <script>
    /* ============================
       PRELOAD IMAGENS e SONS
       ============================ */
    const preloadImages = [
      'assets/tela_fundo.png', 'assets/titulo.png', 'assets/mascote.png', 'assets/moeda.png',
      'assets/medal_gold.png', 'assets/medal_silver.png', 'assets/medal_bronze.png',
      'assets/jogar.png', 'assets/ranking.png', 'assets/som_ligado.png', 'assets/som_desligado.png'
    ];
    preloadImages.forEach(s => { const i = new Image(); i.src = s; });

    function loadAudio(src, volume = 1.0, loop = false) {
      const a = new Audio(src);
      a.preload = 'auto';
      a.volume = volume;
      a.loop = loop;
      try { a.load(); } catch (e) { }
      return a;
    }

    // SONS (ajustados volumes)
    const correctSound = loadAudio('assets/acerto.mp3', 0.45, false);
    const wrongSound = loadAudio('assets/erro.mp3', 0.92, false);
    const nextSound = loadAudio('assets/next.mp3', 0.38, false);
    const winSound = loadAudio('assets/parabens.mp3', 0.9, false);
    const multiplierUpSound = loadAudio('assets/mult_up.mp3', 0.92, false);
    const coinSound = loadAudio('assets/coin.mp3', 0.7, false);
    const clickSound = loadAudio('assets/click.mp3', 0.55, false);
    const explainOpenSound = loadAudio('assets/explain_open.mp3', 0.6, false);
    const ambientSound = loadAudio('assets/ambiente.mp3', 0.28, true);

    window.addEventListener('load', () => {
      try {
        ambientSound.currentTime = 0;
        const p = ambientSound.play();
        if (p && p.catch) p.catch(() => { });
      } catch (e) { }
    });

    let soundEnabled = true;
    function playSound(soundObj) { if (!soundEnabled || !soundObj) return; try { soundObj.currentTime = 0; const p = soundObj.play(); if (p && p.catch) p.catch(() => { }); } catch (e) { } }
    function startAmbient() { if (soundEnabled) try { ambientSound.currentTime = 0; ambientSound.play().catch(() => { }); } catch (e) { } }
    function stopAmbient() { try { ambientSound.pause(); ambientSound.currentTime = 0; } catch (e) { } }

    function tryUnlockAudio() {
      try {
        if (!window.__audioCtx) {
          const C = window.AudioContext || window.webkitAudioContext;
          if (C) { window.__audioCtx = new C(); window.__audioCtx.resume().catch(() => { }); }
        } else { window.__audioCtx.resume && window.__audioCtx.resume().catch(() => { }); }
      } catch (e) { }
      startAmbient();
    }
    document.body.addEventListener('click', tryUnlockAudio, { once: true });

    const questionBank = [
      { question: "O que significa a sigla PIB?", options: ["Produto Interno Bruto", "Produto Interno Brasileiro", "Patrimônio de Influenciadores", "Produto de Investimento em Bolsa"], correctIndex: 0, explain: "A soma de todos os bens e serviços finais produzidos em uma economia. É o principal indicador para medir o tamanho e a saúde de um país." },
      { question: "Qual a função do Banco Central?", options: ["Garantir pagamentos de youtubers", "Investir em startups", "Fiscalizar piadas de políticos", "Regular a taxa de juros para controlar a inflação"], correctIndex: 3, explain: "Sua função é garantir a estabilidade do poder de compra da moeda, controlando a inflação." },
      { question: "O que é inflação?", options: ["Valorização de criptomoeda", "Aumento generalizado e contínuo dos preços", "Reforma política do governo", "Abertura de capital de uma empresa"], correctIndex: 1, explain: "A inflação causa a diminuição do poder de compra da moeda." },
      { question: "O que é investimento?", options: ["Comprar roupas de luxo", "Aplicar dinheiro para fazê-lo crescer", "Gasto do governo em obras", "Transferir dinheiro entre familiares"], correctIndex: 1, explain: "O objetivo é fazer o dinheiro trabalhar para você e crescer ao longo do tempo." },
      { question: "Para que serve uma reserva de emergência?", options: ["Comprar NFTs de youtubers", "Comprar ações", "Cobrir despesas inesperadas (desemprego, saúde)", "Financiar campanha política"], correctIndex: 2, explain: "Ela oferece segurança financeira, evitando que você precise se endividar em caso de imprevistos." },
      { question: "O que é capital de giro?", options: ["Dinheiro de youtubers", "Dinheiro para pagar despesas operacionais (salários, aluguel)", "Receita total de vendas", "Dívida com fornecedores"], correctIndex: 1, explain: "Sem capital de giro, uma empresa não consegue manter suas atividades funcionando." },
      { question: "Diferença entre receita e lucro?", options: ["Receita é o que o governo gasta", "Receita é o que entra; lucro é o que sobra após os custos", "Lucro é o que empresas pagam a influenciadores", "Não há diferença"], correctIndex: 1, explain: "O lucro realmente reflete a saúde financeira do negócio." },
      { question: "Objetivo da política fiscal expansionista?", options: ["Aumentar impostos para jogos de apostas", "Reduzir poder de compra e tirar a moeda de circulação vendendo títulos", "Aumentar gastos e/ou reduzir impostos para estimular a economia", "Diminuir partidos políticos"], correctIndex: 2, explain: "O objetivo é injetar dinheiro na economia para aumentar o consumo e o investimento." },
      { question: "Relação entre taxa de juros e inflação?", options: ["Juros altos ajudam a combater a inflação", "Juros altos aumentam a inflação", "Juros baixos ajudam a combater a inflação", "Sem relação"], correctIndex: 0, explain: "Juros mais altos desincentivam o consumo e o crédito, controlando os preços." },
      { question: "O que é modelo de negócios?", options: ["Descrição de como a empresa cria, entrega e captura valor", "Plano de marketing de político", "Quantia que Netflix usou para financiar filmes e séries", "Lista de produtos"], correctIndex: 0, explain: "O modelo de negócios é a estrutura que sustenta a viabilidade de uma empresa no mercado." },
      { question: "O que é diversificação em investimentos?", options: ["Ação de ex-ministro", "Comprar só um tipo de ativo", "Construção de nova sede", "Espalhar investimentos em diferentes ativos para reduzir risco"], correctIndex: 3, explain: "Distribuir os investimentos diminui a chance de perder dinheiro." },
      { question: "O que é empreendedorismo social?", options: ["Criar empresa para lucrar", "Interagir com seguidores em redes sociais", "Criar empresa para resolver problema social ou ambiental", "Iniciativa do governo para combater pobreza"], correctIndex: 2, explain: "O objetivo principal é causar um impacto positivo na sociedade." },
      { question: "O que é um ativo?", options: ["Conta de luz", "Bem ou direito que pode ser convertido em dinheiro", "Nova lei de imposto", "Valor que youtuber recebe"], correctIndex: 1, explain: "Ativos são tudo o que pode gerar benefício econômico futuro." },
      { question: "O que é fluxo de caixa?", options: ["Movimento de entrada e saída de dinheiro em um período", "Diferença de ganhos da receita federal de um trimestre para o outro", "Quantidade de produtos vendidos", "Valor total de dívidas"], correctIndex: 0, explain: "Analisar o fluxo de caixa é essencial para entender a saúde financeira de um negócio." },
      { question: "O que é crowdfunding?", options: ["Modelo de negócio de jogos de aposta", "Pedido de doação de youtuber", "Financiamento coletivo pela internet, sem um único grande investidor", "Venda de ações na bolsa"], correctIndex: 2, explain: "É uma alternativa de financiamento coletivo, geralmente pela internet." },
      { question: "O que é juro composto?", options: ["Juro sobre o capital inicial", "Juros que banco central cobra", "Juro sobre o capital inicial e juros acumulados", "Taxa de banco"], correctIndex: 2, explain: "É o 'juro sobre juro', o que faz o dinheiro crescer de forma exponencial." },
      { question: "Diferença entre passivo e ativo?", options: ["Ativo é patrimônio de político, passivo é dívida", "Ativo é o que põe dinheiro no bolso; passivo é o que tira", "Ativo é o que compra, passivo é o que vende", "Não há diferença"], correctIndex: 1, explain: "Passivo é o oposto de ativo, representando as dívidas e obrigações." },
      { question: "Para que serve o orçamento pessoal?", options: ["Gastar dinheiro sem controle", "Entender para onde o dinheiro está indo e planejar gastos", "Financiar campanha de youtuber", "Estimativa de gastos do presidente"], correctIndex: 1, explain: "Ele ajuda a tomar decisões mais conscientes e alcançar objetivos financeiros." },
      { question: "O que é empreendedorismo por necessidade?", options: ["Abrir negócio para atender a mercado", "Venda de produtos digitais", "Tipo de empreendedorismo que político defende", "Criar um negócio por não encontrar emprego formal"], correctIndex: 3, explain: "É motivado pela falta de opção, e não por uma oportunidade de mercado." },
      { question: "O que é marketing digital?", options: ["Criação de podcasts", "Conjunto de ações de marketing na internet", "Promoção de político", "Venda em loja virtual"], correctIndex: 1, explain: "O objetivo é atrair clientes e construir relacionamentos usando a tecnologia." },
      { question: "O que é renda fixa?", options: ["Investimento com risco zero", "Investimento com rentabilidade conhecida ou pré-calculada", "Investimento apenas em fundos", "Investimento de político"], correctIndex: 1, explain: "É considerado mais seguro, pois o investidor sabe como será a rentabilidade." },
      { question: "O que é empreendedorismo feminino?", options: ["Negócio com equipe só de mulheres", "Negócio para o público feminino", "Mulheres que criam e gerenciam seus próprios negócios", "Ação de influencer"], correctIndex: 2, explain: "Contribui para a autonomia financeira feminina e a diversidade no mercado." },
      { question: "O que é marketing de conteúdo?", options: ["Produção de conteúdo de político", "Criação de conteúdo para atrair e engajar público", "Compra de anúncios", "Blog sobre vida de youtuber"], correctIndex: 1, explain: "O objetivo é educar, entreter e converter clientes de forma indireta." },
      { question: "O que é endividamento?", options: ["Pegar empréstimo", "Pagar contas em dia", "Situação em que despesas são maiores que receitas", "Aumento do salário mínimo"], correctIndex: 2, explain: "O alto endividamento pode levar à perda de ativos e instabilidade financeira." },
      { question: "O que é uma startup?", options: ["Empresa pequena que vende artesanato apenas no estado no qual reside", "Música de youtuber", "Uma série que aborda temas como tecnologias", "Empresa de tecnologia em busca de modelo de negócio escalável"], correctIndex: 3, explain: "Busca resolver um problema de forma inovadora em condições de incerteza." },
      { question: "O que é imposto de renda?", options: ["Valor que as pessoas pagam para declarar consumo em videogames/streamings", "Imposto sobre produtos importados", "Imposto municipal sobre imóveis", "Imposto federal sobre a renda de pessoas e empresas"], correctIndex: 3, explain: "É um dos principais meios do governo arrecadar recursos para financiar serviços públicos." },
      { question: "O que é empreendedorismo digital?", options: ["Canal no YouTube para vlogs", "Político usando redes sociais", "Negócio que usa a internet e tecnologias digitais", "Loja de rua"], correctIndex: 2, explain: "Explora o potencial da internet para atingir um público amplo com baixo custo." },
      { question: "O que é microcrédito?", options: ["Empréstimo de pequeno valor para microempreendedores", "Empréstimo para grandes empresas", "Empréstimo de R$1 milhão", "Taxa de juros do Banco Central"], correctIndex: 0, explain: "Visa promover a inclusão financeira e o desenvolvimento econômico em comunidades." },
      { question: "O que é risco em investimentos?", options: ["Possibilidade de perder dinheiro em um investimento", "Quantia que o Banco Central investiu", "Lucro garantido", "Valor do imposto"], correctIndex: 0, explain: "Em geral, quanto maior o potencial de retorno, maior é o risco envolvido." },
      { question: "O que é a taxa Selic?", options: ["Taxa para privatizar estatais", "Taxa básica de juros da economia brasileira", "Juros que bancos cobram dos clientes", "Valor que governo paga a youtubers"], correctIndex: 1, explain: "Serve como referência para todas as outras taxas de juros do país, influenciando o crédito." }
    ];



    const quizSize = 12;

    /* ============================
       DOM refs
       ============================ */
    const imgPlay = document.getElementById('imgPlay');
    const imgRanking = document.getElementById('imgRanking');
    const soundBtn = document.getElementById('soundBtn');
    const soundIcon = document.getElementById('soundIcon');
    const menuEl = document.getElementById('menu');
    const quizCard = document.getElementById('quizCard');
    const resultEl = document.getElementById('result');
    const rankingEl = document.getElementById('ranking');

    const speechEl = document.getElementById('speech');
    const qCounterEl = document.getElementById('qCounter');
    const timerEl = document.getElementById('timer');
    const progressBar = document.getElementById('progressBar');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const scoreEl = document.getElementById('score');
    const nextBtn = document.getElementById('nextBtn');
    const showExplainBtn = document.getElementById('showExplainBtn');
    const explainBox = document.getElementById('explainBox');
    const explainText = document.getElementById('explainText');
    const closeExplainBtn = document.getElementById('closeExplainBtn');
    const playerNameInput = document.getElementById('playerName');
    const saveScoreBtn = document.getElementById('saveScoreBtn');
    const finalScoreText = document.getElementById('finalScore');
    const medalDiv = document.getElementById('medal');
    const replayBtn = document.getElementById('replayBtn');
    const viewRankingBtn = document.getElementById('viewRankingBtn');
    const rankingList = document.getElementById('rankingList');
    const backBtn = document.getElementById('backBtn');
    const mascoteEl = document.getElementById('mascote');
    const titleImg = document.getElementById('titleImg');
    const backToMenuBtn = document.getElementById('backToMenuBtn');

    /* ============================
       Estado do jogo
       ============================ */
    let quizData = [];
    let currentQuestion = 0;
    let score = 0;
    let answeredCount = 0;
    let multiplier = 1;
    let streak = 0;
    let timeLeft = 20;
    let timerHandle = null;
    let typingHandle = null;
    let correctCount = 0;

    /* ============================
       Utilitários
       ============================ */
    function shuffleArrayFisherYates(array) {
      const a = array.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function generateQuiz() {
      const copy = shuffleArrayFisherYates(questionBank);
      return copy.slice(0, quizSize);
    }

    function updateProgress() {
      progressBar.innerHTML = '';
      const total = quizData.length || quizSize;
      for (let i = 0; i < total; i++) {
        const d = document.createElement('div'); d.className = 'coin';
        if (i < answeredCount) d.classList.add('active');
        progressBar.appendChild(d);
      }
    }

    function updateScoreDisplay() { scoreEl.textContent = `Pontuação: ${score} | Multiplicador: x${multiplier.toFixed(2)}`; }

    /* typing + balão que expande enquanto digita */
    function typeSpeech(text, onDone) {
      stopTyping();
      speechEl.style.overflow = 'hidden';
      speechEl.style.maxHeight = '28px';
      speechEl.style.padding = '6px';
      speechEl.textContent = '';

      let i = 0;
      typingHandle = setInterval(() => {
        speechEl.textContent += text.charAt(i) || '';
        i++;
        // expande conforme caracteres escritos
        const newH = Math.min(48 + Math.floor(i / 18) * 18, 420);
        speechEl.style.maxHeight = newH + 'px';
        if (newH > 100) speechEl.style.padding = '10px';
        speechEl.scrollTop = speechEl.scrollHeight;
        if (i > text.length) {
          clearInterval(typingHandle);
          typingHandle = null;
          speechEl.style.maxHeight = Math.min(48 + Math.ceil(text.length / 18) * 18, 420) + 'px';
          speechEl.style.padding = '10px';
          if (typeof onDone === 'function') onDone();
        }
      }, 24);
    }
    function stopTyping() { if (typingHandle) { clearInterval(typingHandle); typingHandle = null; } }

    function openExplainBox() {
      explainBox.style.display = 'block';
      requestAnimationFrame(() => {
        explainBox.style.maxHeight = '400px';
        explainBox.style.padding = '10px';
      });
      playSound(explainOpenSound);
    }
    function closeExplainBox() {
      explainBox.style.maxHeight = '0';
      explainBox.style.padding = '0 10px';
      setTimeout(() => { explainBox.style.display = 'none'; }, 260);
    }

    /* confetti */
    function showConfetti() {
      for (let i = 0; i < 18; i++) {
        const c = document.createElement('div');
        c.className = 'confete';
        c.style.left = (window.innerWidth / 2 + (Math.random() * 260 - 130)) + 'px';
        c.style.top = (80 + Math.random() * 40) + 'px';
        c.style.background = ['#ff0', '#f0a', '#0ff', '#0f0', '#f90'][Math.floor(Math.random() * 5)];
        document.body.appendChild(c);
        setTimeout(() => c.remove(), 1800);
      }
    }

    function updateStreakIndicator() {
      const stars = Array.from(document.querySelectorAll('.st-star'));
      let lit = streak % 3;
      if (streak > 0 && lit === 0) lit = 3;
      stars.forEach((s, idx) => { if (idx < lit) s.classList.add('active'); else s.classList.remove('active'); });
    }

    /* ============================
       Menu interactions
       ============================ */
    imgPlay.addEventListener('click', () => { playSound(clickSound); tryUnlockAudio(); startGame(); });
    imgRanking.addEventListener('click', () => { playSound(clickSound); showRanking(); });
    soundBtn.addEventListener('click', () => {
      soundEnabled = !soundEnabled;
      soundIcon.src = soundEnabled ? 'assets/som_ligado.png' : 'assets/som_desligado.png';
      if (soundEnabled) startAmbient(); else stopAmbient();
      playSound(clickSound);
    });

    /* ============================
       Iniciar jogo / carregar pergunta
       ============================ */
    function startGame() {
      titleImg.style.display = 'none';
      menuEl.style.display = 'none';
      rankingEl.classList.add('hidden');
      resultEl.classList.add('hidden');
      quizCard.classList.remove('hidden');
      document.body.classList.add('quiz-active');

      quizData = generateQuiz();
      currentQuestion = 0; score = 0; answeredCount = 0; multiplier = 1; streak = 0; correctCount = 0;
      updateScoreDisplay(); updateProgress(); updateStreakIndicator();
      loadQuestion();
    }

    function loadQuestion() {
      clearInterval(timerHandle);
      stopTyping();

      timeLeft = 20; timerEl.textContent = `Tempo: ${timeLeft}s`;
      nextBtn.disabled = true;
      showExplainBtn.style.display = 'none';
      closeExplainBox(); explainText.textContent = '';

      const q = quizData[currentQuestion];
      // questionEl oculto visualmente, mantido para acessibilidade
      questionEl.textContent = '';

      optionsEl.innerHTML = '';

      const idx = shuffleArrayFisherYates([0, 1, 2, 3]);
      idx.forEach(origIndex => {
        const btn = document.createElement('button');
        btn.className = 'option';
        btn.type = 'button';
        btn.textContent = q.options[origIndex];
        btn.dataset.orig = origIndex;
        btn.addEventListener('click', () => selectAnswer(origIndex, q.correctIndex));
        optionsEl.appendChild(btn);
      });

      // garante balão fechado antes de digitar
      speechEl.style.maxHeight = '28px';
      speechEl.style.padding = '6px';
      speechEl.textContent = '';

      // Mascote fala (typing). Timer começa quando terminar.
      typeSpeech(q.question, () => {
        questionEl.textContent = q.question;
        startTimer();
        const firstBtn = optionsEl.querySelector('.option'); if (firstBtn) firstBtn.focus();
      });
    }

    /* ============================
       Timer
       ============================ */
    function startTimer() {
      clearInterval(timerHandle);
      const total = 20; let elapsed = 0;
      if (progressBar.querySelectorAll('.coin').length === 0) updateProgress();
      timerHandle = setInterval(() => {
        elapsed += 1;
        timeLeft = total - elapsed;
        if (timeLeft < 0) timeLeft = 0;
        timerEl.textContent = `Tempo: ${timeLeft}s`;
        if (elapsed >= total) {
          clearInterval(timerHandle);
          selectAnswer(null, quizData[currentQuestion].correctIndex);
        }
      }, 1000);
    }
    function stopTimer() { if (timerHandle) { clearInterval(timerHandle); timerHandle = null; } }

    /* ============================
       Processar resposta
       ============================ */
    function selectAnswer(selectedIndex, correctIndex) {
      stopTimer();
      const buttons = Array.from(optionsEl.querySelectorAll('.option'));
      buttons.forEach(b => b.disabled = true);
      buttons.forEach(b => {
        const orig = Number(b.dataset.orig);
        if (orig === correctIndex) b.classList.add('correct');
        if (selectedIndex !== null && orig === selectedIndex && orig !== correctIndex) b.classList.add('wrong');
      });

      mascoteEl.classList.remove('correct', 'wrong');
      if (selectedIndex !== null && selectedIndex === correctIndex) {
        mascoteEl.classList.add('correct'); setTimeout(() => mascoteEl.classList.remove('correct'), 800);
      } else {
        mascoteEl.classList.add('wrong'); setTimeout(() => mascoteEl.classList.remove('wrong'), 800);
      }

      const prevMultiplier = multiplier;
      if (selectedIndex !== null && selectedIndex === correctIndex) {
        streak++;
        multiplier = 1 + Math.floor(streak / 3) * 0.25;
        const gained = Math.round(10 * multiplier);
        score += gained;
        correctCount++;
        playSound(correctSound); playSound(coinSound);
        if (multiplier > prevMultiplier) { playSound(multiplierUpSound); showConfetti(); }
      } else {
        streak = 0; multiplier = 1;
        playSound(wrongSound);
      }

      answeredCount++;
      updateProgress();
      updateScoreDisplay();
      updateStreakIndicator();

      const q = quizData[currentQuestion];
      showExplainBtn.style.display = (q.explain && q.explain.trim()) ? 'inline-block' : 'none';
      explainText.textContent = q.explain || '';

      nextBtn.disabled = false;
    }

    /* Próxima */
    nextBtn.addEventListener('click', () => {
      playSound(nextSound);
      currentQuestion++;
      if (currentQuestion < quizData.length) loadQuestion();
      else showResult();
    });

    /* Explicação */
    showExplainBtn.addEventListener('click', () => openExplainBox());
    closeExplainBtn.addEventListener('click', () => closeExplainBox());

    /* Resultado */
    function showResult() {
      stopTimer();
      quizCard.classList.add('hidden');
      resultEl.classList.remove('hidden');

      const percent = Math.round((correctCount / quizData.length) * 100);
      finalScoreText.textContent = `Sua pontuação final: ${score} pontos — Acertos: ${correctCount}/${quizData.length} (${percent}%)`;
      medalDiv.innerHTML = '';

      let list = JSON.parse(localStorage.getItem('quiz_ranking_v2') || '[]');
      let insertPos = list.findIndex(e => score > e.score);
      if (insertPos === -1) insertPos = list.length;

      let medalFile = null;
      if (insertPos === 0) medalFile = 'medal_gold.png';
      else if (insertPos === 1) medalFile = 'medal_silver.png';
      else if (insertPos === 2) medalFile = 'medal_bronze.png';

      if (medalFile) {
        const img = new Image(); img.src = 'assets/' + medalFile; img.alt = 'Medalha'; medalDiv.appendChild(img);
        playSound(winSound);
      }
      setTimeout(() => playerNameInput.focus(), 200);
    }

    /* Salvar ranking */
    function saveRanking(name, pontos) {
      if (!name || !name.trim()) return { ok: false, reason: 'empty' };
      if (name.length < 2 || name.length > 20) return { ok: false, reason: 'length' };
      let list = JSON.parse(localStorage.getItem('quiz_ranking_v2') || '[]');
      if (list.some(e => e.name === name)) return { ok: false, reason: 'duplicate' };
      list.push({ name: name.trim(), score: pontos, date: Date.now() });
      list.sort((a, b) => b.score - a.score || a.date - b.date);
      list = list.slice(0, 10);
      localStorage.setItem('quiz_ranking_v2', JSON.stringify(list));
      return { ok: true };
    }

    saveScoreBtn.addEventListener('click', () => {
      const name = playerNameInput.value;
      const res = saveRanking(name, score);
      if (!res.ok) {
        if (res.reason === 'empty') { alert('Digite seu nome para salvar no ranking.'); playerNameInput.focus(); }
        else if (res.reason === 'length') { alert('Nome deve ter entre 2 e 20 caracteres.'); playerNameInput.focus(); }
        else if (res.reason === 'duplicate') { alert('Nome já existe no ranking. Use outro nome. (Case-sensitive)'); playerNameInput.focus(); }
        return;
      }
      playerNameInput.value = '';
      resultEl.classList.add('hidden');
      menuEl.style.display = 'block';
      titleImg.style.display = 'block';
    });

    /* replay / ver ranking / voltar ao menu */
    replayBtn.addEventListener('click', () => {
      playSound(clickSound);
      resultEl.classList.add('hidden');
      quizCard.classList.remove('hidden');
      quizData = generateQuiz();
      currentQuestion = 0; score = 0; answeredCount = 0; multiplier = 1; streak = 0; correctCount = 0;
      updateScoreDisplay(); updateProgress(); updateStreakIndicator();
      loadQuestion();
    });
    viewRankingBtn.addEventListener('click', () => showRanking());
    backToMenuBtn.addEventListener('click', () => {
      resultEl.classList.add('hidden');
      menuEl.style.display = 'block';
      titleImg.style.display = 'block';
    });

    /* Ranking: renderizar */
    function showRanking() {
      menuEl.style.display = 'none';
      quizCard.classList.add('hidden');
      resultEl.classList.add('hidden');
      rankingEl.classList.remove('hidden');

      const list = JSON.parse(localStorage.getItem('quiz_ranking_v2') || '[]');
      rankingList.innerHTML = '';
      list.forEach((entry, i) => {
        const li = document.createElement('li'); li.style.display = 'flex'; li.style.alignItems = 'center'; li.style.gap = '8px'; li.style.padding = '8px'; li.style.borderRadius = '8px'; li.style.marginBottom = '6px'; li.style.background = 'rgba(0,0,0,0.03)';
        const left = document.createElement('div'); left.style.display = 'flex'; left.style.alignItems = 'center'; left.style.gap = '8px';
        if (i === 0) { const img = new Image(); img.src = 'assets/medal_gold.png'; img.style.width = '28px'; left.appendChild(img); }
        else if (i === 1) { const img = new Image(); img.src = 'assets/medal_silver.png'; img.style.width = '28px'; left.appendChild(img); }
        else if (i === 2) { const img = new Image(); img.src = 'assets/medal_bronze.png'; img.style.width = '28px'; left.appendChild(img); }
        const text = document.createElement('span'); text.textContent = `${i + 1}. ${entry.name}`; left.appendChild(text);
        const scoreSpan = document.createElement('span'); scoreSpan.textContent = `${entry.score} pts`; scoreSpan.style.marginLeft = 'auto';
        li.appendChild(left); li.appendChild(scoreSpan); rankingList.appendChild(li);
      });
    }
    backBtn.addEventListener('click', () => {
      rankingEl.classList.add('hidden');
      menuEl.style.display = 'block';
    });

    /* atalhos teclado */
    window.addEventListener('keydown', (e) => {
      if (!quizCard.classList.contains('hidden')) {
        const key = e.key.toLowerCase();
        if (['1', '2', '3', '4'].includes(key)) {
          const idx = Number(key) - 1;
          const btns = Array.from(document.querySelectorAll('.option'));
          if (btns[idx] && !btns[idx].disabled) btns[idx].click();
        } else if (['a', 'b', 'c', 'd'].includes(key)) {
          const map = { 'a': 0, 'b': 1, 'c': 2, 'd': 3 };
          const btns = Array.from(document.querySelectorAll('.option'));
          if (btns[map[key]] && !btns[map[key]].disabled) btns[map[key]].click();
        } else if (key === 'enter') {
          if (!nextBtn.disabled) nextBtn.click();
        }
      }
    });

    /* Inicial UI */
    menuEl.style.display = 'block';
    quizCard.classList.add('hidden');
    resultEl.classList.add('hidden');
    rankingEl.classList.add('hidden');
    updateProgress();
    updateScoreDisplay();
    updateStreakIndicator();

  </script>
</body>

</html>
